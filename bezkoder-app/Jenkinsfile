pipeline {
  environment {
    JENKINS_SONAR_TOKEN = credentials('jenkins_sonar_token')
  }
  agent {
    kubernetes {
      yaml '''
        apiVersion: v1
        kind: Pod
        spec:
          containers:
          - name: maven
            image: maven:3.8.1-adoptopenjdk-11
            command:
            - cat
            tty: true
        '''
    }
  }
  stages {
     
     stage('maven-build') {
       steps {
         container('maven') {
           sh 'echo salam zakariaa'
         }
       }
     }
     
     stage('sonar') {
       steps {
         container('maven') {
            sh 'mvn clean install -f bezkoder-app/pom.xml -Dmaven.test.failure.ignore=true sonar:sonar -Dsonar.projectKey=container_solutions_task -Dsonar.host.url=http://sonarqube.sonarqube.svc:9000 -Dsonar.coverage.jacoco.xmlReportPaths=target/site/jacoco/jacoco.xml,target/site/jacoco-aggregate/jacoco.xml,target/jacoco-report/jacoco.xml,target/site/jacoco-aggregate-all/jacoco.xml -Dsonar.login=${JENKINS_SONAR_TOKEN}'
         }
       }
     }
  }
}